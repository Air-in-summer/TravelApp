<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:TravelApplication.ViewModels"
             xmlns:models="clr-namespace:TravelApplication.Models"
             x:Class="TravelApplication.Pages.MajorPage.TripsPage"
             x:DataType="viewmodels:TripsViewModel"
             x:Name="TripsPages"
             Title="My Adventures"
             BackgroundColor="#F5F5F5">
    
    <ContentPage.ToolbarItems>
        <ToolbarItem Text="âž• New Trip" Clicked="AddTripCommand"/>
    </ContentPage.ToolbarItems>

    <Grid RowDefinitions="Auto,*">
        
        <!-- Header Section -->
        <VerticalStackLayout Grid.Row="0" Padding="20,15,20,10">
            <Label Text="Plan, explore, and remember!"
                   HorizontalOptions="Center"
                   FontSize="16"
                   TextColor="#757575"/>
        </VerticalStackLayout>
        
        <!-- Content -->
        <Grid Grid.Row="1">
            <!-- Loading Indicator -->
            <ActivityIndicator IsVisible="{Binding IsBusy}" 
                             IsRunning="{Binding IsBusy}"
                             Color="#2196F3"
                             HeightRequest="50"
                             VerticalOptions="Center"
                             HorizontalOptions="Center"/>

            <!-- Trips List -->
            <CollectionView ItemsSource="{Binding Trips}"
                          SelectionMode="None"
                          IsVisible="{Binding IsNotBusy}"
                          Margin="15,0,15,10">
                
                <CollectionView.EmptyView>
                    <VerticalStackLayout VerticalOptions="Center" 
                                        HorizontalOptions="Center" 
                                        Spacing="15"
                                        Padding="20">
                        <Border WidthRequest="120"
                                HeightRequest="120"
                                BackgroundColor="#E3F2FD"
                                StrokeThickness="0"
                                HorizontalOptions="Center">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="60"/>
                            </Border.StrokeShape>
                            <Label Text="âœˆï¸" 
                                   FontSize="60" 
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center"/>
                        </Border>
                        <Label Text="No trips yet" 
                               FontSize="22" 
                               FontAttributes="Bold"
                               TextColor="#212121"
                               HorizontalOptions="Center"/>
                        <Label Text="Start planning your next adventure!"
                               FontSize="15"
                               TextColor="Gray"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"/>
                    </VerticalStackLayout>
                </CollectionView.EmptyView>
                
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Trip">
                        <Border Margin="0,0,0,15"
                                Padding="0"
                                StrokeThickness="0"
                                BackgroundColor="White">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="16"/>
                            </Border.StrokeShape>
                            <Border.Shadow>
                                <Shadow Brush="Black" Opacity="0.1" Radius="12" Offset="0,4"/>
                            </Border.Shadow>
                            <Border.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding GoToTripDetailsCommand, Source={x:Reference TripsPages}}"
                                                      CommandParameter="{Binding .}"/>
                            </Border.GestureRecognizers>

                            <Grid RowDefinitions="Auto,Auto,Auto,Auto" Padding="20">
                                
                                <!-- Header: Title + Delete Button -->
                                <Grid Grid.Row="0" ColumnDefinitions="*,Auto" Margin="0,0,0,8">
                                    <Label Grid.Column="0"
                                           Text="{Binding Title}"
                                           FontSize="22"
                                           FontAttributes="Bold"
                                           TextColor="#212121"
                                           LineBreakMode="TailTruncation"
                                           MaxLines="1"
                                           VerticalOptions="Center"/>
                                    
                                    <Border Grid.Column="1"
                                            WidthRequest="36"
                                            HeightRequest="36"
                                            BackgroundColor="#FFEBEE"
                                            StrokeThickness="0"
                                            VerticalOptions="Center">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="18"/>
                                        </Border.StrokeShape>
                                        <Border.GestureRecognizers>
                                            <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:TripsViewModel}}, Path=DeleteTripCommand}"
                                                                  CommandParameter="{Binding .}"/>
                                        </Border.GestureRecognizers>
                                        <Label Text="ðŸ—‘ï¸"
                                               FontSize="18"
                                               HorizontalOptions="Center"
                                               VerticalOptions="Center"/>
                                    </Border>
                                </Grid>
                                
                                <!-- Description -->
                                <Label Grid.Row="1"
                                       Text="{Binding Description}"
                                       FontSize="15"
                                       TextColor="#616161"
                                       LineBreakMode="WordWrap"
                                       MaxLines="2"
                                       Margin="0,0,0,12"/>
                                
                                <!-- Date Range -->
                                <Border Grid.Row="2"
                                        Padding="12,8"
                                        BackgroundColor="#E8F5E9"
                                        StrokeThickness="0"
                                        Margin="0,0,0,10">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="8"/>
                                    </Border.StrokeShape>
                                    <HorizontalStackLayout Spacing="8">
                                        <Label Text="ðŸ“…"
                                               FontSize="16"
                                               VerticalOptions="Center"/>
                                        <Label FontSize="14"
                                               FontAttributes="Bold"
                                               TextColor="#2E7D32"
                                               VerticalOptions="Center">
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <Span Text="{Binding StartDate, StringFormat='{0:MMM dd}'}"/>
                                                    <Span Text=" - "/>
                                                    <Span Text="{Binding EndDate, StringFormat='{0:MMM dd, yyyy}'}"/>
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>
                                    </HorizontalStackLayout>
                                </Border>
                                
                                <!-- Destination + Budget -->
                                <Grid Grid.Row="3" ColumnDefinitions="*,Auto" ColumnSpacing="10">
                                    <!-- Destination -->
                                    <HorizontalStackLayout Grid.Column="0" Spacing="6">
                                        <Label Text="ðŸ“"
                                               FontSize="14"
                                               VerticalOptions="Center"/>
                                        <Label Text="{Binding DestinationName}"
                                               FontSize="14"
                                               FontAttributes="Bold"
                                               TextColor="#2196F3"
                                               VerticalOptions="Center"
                                               LineBreakMode="TailTruncation"/>
                                    </HorizontalStackLayout>
                                    
                                    <!-- Budget Badge -->
                                    <Border Grid.Column="1"
                                            Padding="10,6"
                                            BackgroundColor="#FFF3E0"
                                            StrokeThickness="0">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="12"/>
                                        </Border.StrokeShape>
                                        <Label Text="{Binding Budget, StringFormat='ðŸ’° ${0:N0}'}"
                                               FontSize="13"
                                               FontAttributes="Bold"
                                               TextColor="#F57C00"/>
                                    </Border>
                                </Grid>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Grid>
    </Grid>
</ContentPage>