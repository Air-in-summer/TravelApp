<?xml version="1.0" encoding="utf-8" ?>
<toolkit:Popup xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
               xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
               x:Class="TravelApplication.Pages.MajorPage.SuggestViewPopup"
               xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
               xmlns:models="clr-namespace:TravelApplication.Models"
               
               VerticalOptions="End">

    <ScrollView BackgroundColor="#F5F5F5">
        <VerticalStackLayout Spacing="18" Padding="20">

            <!-- Header -->
            <Border BackgroundColor="White" 
                    Padding="20"
                    StrokeThickness="0"
                    Margin="0,0,0,10">
                <Border.Shadow>
                    <Shadow Brush="Black" Opacity="0.1" Radius="12" Offset="0,4"/>
                </Border.Shadow>
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="16"/>
                </Border.StrokeShape>
                <HorizontalStackLayout Spacing="12">
                    <Border BackgroundColor="#E3F2FD" 
                            WidthRequest="50" 
                            HeightRequest="50"
                            StrokeThickness="0">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="12"/>
                        </Border.StrokeShape>
                        <Label Text="âœ¨" 
                               FontSize="26" 
                               HorizontalOptions="Center" 
                               VerticalOptions="Center"/>
                    </Border>
                    <VerticalStackLayout Spacing="4" VerticalOptions="Center">
                        <Label Text="Optimized Itinerary" 
                               FontSize="24" 
                               FontAttributes="Bold"
                               TextColor="#212121"/>
                        <Label Text="Review and save your route"
                               FontSize="14"
                               TextColor="#616161"/>
                    </VerticalStackLayout>
                </HorizontalStackLayout>
            </Border>

            <!-- Stops Collection -->
            <CollectionView ItemsSource="{Binding SuggestedStops}" SelectionMode="None">
                <CollectionView.EmptyView>
                    <Border BackgroundColor="White" 
                            Padding="40,60"
                            StrokeThickness="0">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="16"/>
                        </Border.StrokeShape>
                        <Border.Shadow>
                            <Shadow Brush="Black" Opacity="0.08" Radius="10" Offset="0,2"/>
                        </Border.Shadow>
                        <VerticalStackLayout Spacing="12" HorizontalOptions="Center">
                            <Label Text="ðŸ“" 
                                   FontSize="48" 
                                   HorizontalOptions="Center"/>
                            <Label Text="No Suggestions" 
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextColor="#212121"
                                   HorizontalOptions="Center"/>
                            <Label Text="Unable to generate optimized route"
                                   FontSize="14"
                                   TextColor="#616161"
                                   HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                    </Border>
                </CollectionView.EmptyView>
                
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Stop">
                        <Border BackgroundColor="White" 
                                Padding="18" 
                                Margin="0,0,0,12"
                                StrokeThickness="0">
                            <Border.Shadow>
                                <Shadow Brush="Black" Opacity="0.08" Radius="10" Offset="0,2"/>
                            </Border.Shadow>
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="15"/>
                            </Border.StrokeShape>
                            
                            <Grid RowDefinitions="Auto,Auto,Auto,Auto" ColumnDefinitions="*" RowSpacing="10">
                                
                                <!-- Location Header -->
                                <Label Grid.Row="0"
                                       Text="{Binding Location}" 
                                       FontAttributes="Bold" 
                                       FontSize="19" 
                                       TextColor="#212121"
                                       LineBreakMode="WordWrap"/>

                                <!-- Notes -->
                                <Label Grid.Row="1"
                                       Text="{Binding Notes}" 
                                       TextColor="#757575" 
                                       FontSize="14"
                                       LineBreakMode="WordWrap"
                                       MaxLines="2"/>

                                <!-- Date/Time Badge -->
                                <Border Grid.Row="2"
                                        Padding="12,10"
                                        BackgroundColor="#FFF3E0"
                                        StrokeThickness="0"
                                        HorizontalOptions="Start">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="10"/>
                                    </Border.StrokeShape>
                                    <HorizontalStackLayout Spacing="6">
                                        <Label Text="ðŸ—“ï¸:" 
                                               FontSize="15" 
                                               FontAttributes="Bold"
                                               TextColor="#F57C00"
                                               VerticalOptions="Center"/>
                                        <Label Text="{Binding ArrivalDate, StringFormat='{0:dd/MM HH:mm}'}" 
                                               FontSize="13"
                                               FontAttributes="Bold"
                                               TextColor="#F57C00"
                                               VerticalOptions="Center"/>
                                        <Label Text="â†’" 
                                               FontSize="14"
                                               FontAttributes="Bold"
                                               TextColor="#F57C00"
                                               VerticalOptions="Center"/>
                                        <Label Text="{Binding DepartureDate, StringFormat='{0:dd/MM HH:mm}'}" 
                                               FontSize="13"
                                               FontAttributes="Bold"
                                               TextColor="#F57C00"
                                               VerticalOptions="Center"/>
                                    </HorizontalStackLayout>
                                </Border>

                                <!-- Cost & Category Row -->
                                <HorizontalStackLayout Grid.Row="3" Spacing="12">
                                    <!-- Cost Badge -->
                                    <Border Padding="12,8"
                                            BackgroundColor="#E8F5E9"
                                            StrokeThickness="0">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="12"/>
                                        </Border.StrokeShape>
                                        <Label Text="{Binding EstimatedCost, StringFormat='ðŸ’° {0:N0} Ä‘'}" 
                                               FontSize="14"
                                               FontAttributes="Bold"
                                               TextColor="#2E7D32"/>
                                    </Border>
                                    
                                    <!-- Category Badge -->
                                    <Border Padding="10,6"
                                            BackgroundColor="#F3E5F5"
                                            StrokeThickness="0">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="10"/>
                                        </Border.StrokeShape>
                                        <Label Text="{Binding Category}" 
                                               FontSize="12"
                                               FontAttributes="Bold"
                                               TextColor="#7B1FA2"/>
                                    </Border>
                                </HorizontalStackLayout>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Action Buttons -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="12" Margin="0,10,0,0">
                <!-- Save Button -->
                <Border Grid.Column="0"
                        BackgroundColor="#4CAF50"
                        StrokeThickness="0">
                    <Border.Shadow>
                        <Shadow Brush="#4CAF50" Opacity="0.3" Radius="10" Offset="0,4"/>
                    </Border.Shadow>
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12"/>
                    </Border.StrokeShape>
                    <Button Text="ðŸ’¾ Save" 
                            Clicked="OnConfirmClicked"
                            TextColor="White" 
                            BackgroundColor="Transparent"
                            FontSize="16"
                            FontAttributes="Bold"
                            HeightRequest="54"/>
                </Border>
                
                <!-- Cancel Button -->
                <Border Grid.Column="1"
                        BackgroundColor="#F44336"
                        StrokeThickness="0">
                    <Border.Shadow>
                        <Shadow Brush="#F44336" Opacity="0.3" Radius="10" Offset="0,4"/>
                    </Border.Shadow>
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12"/>
                    </Border.StrokeShape>
                    <Button Text="âœ– Cancel" 
                            Clicked="OnCancelClicked"
                            TextColor="White" 
                            BackgroundColor="Transparent"
                            FontSize="16"
                            FontAttributes="Bold"
                            HeightRequest="54"/>
                </Border>
            </Grid>

        </VerticalStackLayout>
    </ScrollView>
</toolkit:Popup>
