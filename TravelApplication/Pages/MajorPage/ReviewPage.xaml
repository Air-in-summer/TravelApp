<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodel="clr-namespace:TravelApplication.ViewModels"
             xmlns:models="clr-namespace:TravelApplication.Models"
             x:Class="TravelApplication.Pages.MajorPage.ReviewPage"
             Title="Reviews"
             BackgroundColor="#F5F5F5">
    
    <ContentPage.BindingContext>
        <viewmodel:ReviewViewModel />
    </ContentPage.BindingContext>

    <Grid RowDefinitions="Auto,Auto,*" Padding="15,10">
        
        <!-- Header -->
        <Label Grid.Row="0"
               Text="Discover Reviews"
               FontSize="28"
               FontAttributes="Bold"
               TextColor="#212121"
               Margin="5,10,0,15"/>
        
        <!-- Search Bar -->
        <Border Grid.Row="1"
                StrokeThickness="0"
                BackgroundColor="White"
                Margin="0,0,0,15">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="25"/>
            </Border.StrokeShape>
            <Border.Shadow>
                <Shadow Brush="Black" Opacity="0.08" Radius="8" Offset="0,2"/>
            </Border.Shadow>
            <SearchBar Placeholder="ðŸ” Search by place or city..."
                       Text="{Binding SearchQuery}"
                       SearchCommand="{Binding SearchReviewsCommand}"
                       BackgroundColor="Transparent"
                       PlaceholderColor="#9E9E9E"
                       TextColor="#212121"/>
        </Border>

        <!-- Reviews List -->
        <RefreshView Grid.Row="2"
                     IsRefreshing="{Binding IsRefreshing}"
                     Command="{Binding LoadAllReviewsCommand}">
            
            <CollectionView ItemsSource="{Binding FilteredReviews}">
                <CollectionView.EmptyView>
                    <VerticalStackLayout VerticalOptions="Center" 
                                        HorizontalOptions="Center" 
                                        Spacing="15"
                                        Padding="20">
                        <Border WidthRequest="100"
                                HeightRequest="100"
                                BackgroundColor="#E3F2FD"
                                StrokeThickness="0"
                                HorizontalOptions="Center">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="50"/>
                            </Border.StrokeShape>
                            <Label Text="ðŸ“" 
                                   FontSize="50" 
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center"/>
                        </Border>
                        <Label Text="No reviews yet" 
                               FontSize="20" 
                               FontAttributes="Bold"
                               TextColor="#212121"
                               HorizontalOptions="Center"/>
                        <Label Text="Be the first to review a place!"
                               FontSize="14"
                               TextColor="Gray"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"/>
                    </VerticalStackLayout>
                </CollectionView.EmptyView>

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Review">
                        <Border Margin="0,0,0,12"
                                Padding="0"
                                StrokeThickness="0"
                                BackgroundColor="White">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="15"/>
                            </Border.StrokeShape>
                            <Border.Shadow>
                                <Shadow Brush="Black" Opacity="0.08" Radius="10" Offset="0,2"/>
                            </Border.Shadow>
                            
                            <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto" 
                                  Padding="18"
                                  RowSpacing="10">
                                
                                <!-- Place Name + Rating -->
                                <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                                    <Label Grid.Column="0"
                                           Text="{Binding PlaceName}"
                                           FontSize="18"
                                           FontAttributes="Bold"
                                           TextColor="#212121"
                                           VerticalOptions="Center"/>
                                    
                                    <Border Grid.Column="1"
                                            Padding="8,4"
                                            BackgroundColor="#FFF3E0"
                                            StrokeThickness="0">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="12"/>
                                        </Border.StrokeShape>
                                        <Label Text="{Binding Rating, StringFormat='â­ {0}'}"
                                               FontSize="14"
                                               FontAttributes="Bold"
                                               TextColor="#FF9800"/>
                                    </Border>
                                </Grid>
                                
                                <!-- User Info -->
                                <HorizontalStackLayout Grid.Row="1" Spacing="8">
                                    <Border WidthRequest="24"
                                            HeightRequest="24"
                                            BackgroundColor="#E3F2FD"
                                            StrokeThickness="0">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="12"/>
                                        </Border.StrokeShape>
                                        <Label Text="ðŸ‘¤"
                                               FontSize="14"
                                               HorizontalOptions="Center"
                                               VerticalOptions="Center"/>
                                    </Border>
                                    <Label Text="{Binding UserName}"
                                           FontSize="14"
                                           FontAttributes="Bold"
                                           TextColor="#2196F3"
                                           VerticalOptions="Center"/>
                                </HorizontalStackLayout>
                                
                                <!-- Review Text -->
                                <Label Grid.Row="2"
                                       Text="{Binding ReviewText}"
                                       FontSize="15"
                                       TextColor="#424242"
                                       LineBreakMode="WordWrap"
                                       MaxLines="4"/>
                                
                                <!-- Location -->
                                <HorizontalStackLayout Grid.Row="3" Spacing="6">
                                    <Label Text="ðŸ“"
                                           FontSize="12"
                                           VerticalOptions="Center"/>
                                    <Label Text="{Binding Address}"
                                           FontSize="13"
                                           TextColor="#757575"
                                           VerticalOptions="Center"
                                           LineBreakMode="TailTruncation"
                                           MaxLines="1"/>
                                </HorizontalStackLayout>
                                
                                <!-- Date -->
                                <HorizontalStackLayout Grid.Row="4" Spacing="6">
                                    <Label Text="ðŸ•’"
                                           FontSize="12"
                                           VerticalOptions="Center"/>
                                    <Label Text="{Binding UpdatedAt, StringFormat='{0:dd MMM yyyy}'}"
                                           FontSize="13"
                                           TextColor="#757575"
                                           VerticalOptions="Center"/>
                                </HorizontalStackLayout>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>
    </Grid>
</ContentPage>