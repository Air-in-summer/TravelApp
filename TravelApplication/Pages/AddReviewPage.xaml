<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodel="clr-namespace:TravelApplication.ViewModels"
             xmlns:models="clr-namespace:TravelApplication.Models"
             x:Class="TravelApplication.Pages.AddReviewPage"
             x:DataType="viewmodel:AddReviewViewModel"
             Title="{Binding Title}"
             BackgroundColor="#F5F5F5">
    
    <ScrollView Padding="20,15">
        <VerticalStackLayout Spacing="20">
            
            <!-- Header -->
            <Label Text="Share Your Experience"
                   FontSize="26"
                   FontAttributes="Bold"
                   TextColor="#212121"/>
            
            <!-- Place Search Card - Hidden in Edit mode -->
            <Border StrokeThickness="0"
                    BackgroundColor="White"
                    Padding="18">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="15"/>
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="Black" Opacity="0.08" Radius="10" Offset="0,2"/>
                </Border.Shadow>
                <Border.Triggers>
                    <DataTrigger TargetType="Border" Binding="{Binding IsEditMode}" Value="True">
                        <Setter Property="IsVisible" Value="False"/>
                    </DataTrigger>
                </Border.Triggers>
                
                <VerticalStackLayout Spacing="12">
                    <Label Text="ðŸ“ Select Place"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="#2196F3"/>
                    
                    <!-- Search Bar -->
                    <Border StrokeThickness="0"
                            BackgroundColor="#F5F5F5">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="10"/>
                        </Border.StrokeShape>
                        <SearchBar Placeholder="ðŸ” Search for a place..."
                                   Text="{Binding SearchQuery}"
                                   SearchCommand="{Binding SearchPlacesCommand}"
                                   BackgroundColor="Transparent"
                                   PlaceholderColor="#9E9E9E"/>
                    </Border>
                    
                    <!-- Search Results -->
                    <CollectionView ItemsSource="{Binding SearchResults}"
                                    MaximumHeightRequest="220"
                                    IsVisible="{Binding IsSearchResultsVisible}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="models:GeoapifyPlacesResult">
                                <Border Padding="12"
                                        Margin="0,0,0,8"
                                        BackgroundColor="#E3F2FD"
                                        StrokeThickness="0">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="10"/>
                                    </Border.StrokeShape>
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:AddReviewViewModel}}, Path=SelectPlaceCommand}"
                                                              CommandParameter="{Binding .}"/>
                                    </Border.GestureRecognizers>
                                    <VerticalStackLayout Spacing="4">
                                        <Label Text="{Binding Location}"
                                               FontAttributes="Bold"
                                               FontSize="15"
                                               TextColor="#1565C0"/>
                                        <Label Text="{Binding Category}"
                                               FontSize="12"
                                               TextColor="#424242"/>
                                    </VerticalStackLayout>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Border>
            
            <!-- Selected Place Display -->
            <Border Padding="15,12"
                    BackgroundColor="#E8F5E9"
                    StrokeThickness="0">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="10"/>
                </Border.StrokeShape>
                <HorizontalStackLayout Spacing="8">
                    <Label Text="âœ…"
                           FontSize="18"
                           VerticalOptions="Center"/>
                    <Label Text="{Binding CurrentReview.PlaceName}"
                           FontSize="15"
                           FontAttributes="Bold"
                           TextColor="#2E7D32"
                           VerticalOptions="Center"/>
                </HorizontalStackLayout>
            </Border>
            
            <!-- Rating Card -->
            <Border StrokeThickness="0"
                    BackgroundColor="White"
                    Padding="18">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="15"/>
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="Black" Opacity="0.08" Radius="10" Offset="0,2"/>
                </Border.Shadow>
                
                <VerticalStackLayout Spacing="15">
                    <Label Text="â­ Your Rating"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="#FF9800"/>
                    
                    <!-- Rating Stars -->
                    <HorizontalStackLayout Spacing="8" HorizontalOptions="Center">
                        <!-- Star 1 -->
                        <Label FontSize="48" Text="â˜†">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding SetRatingCommand}">
                                    <TapGestureRecognizer.CommandParameter>
                                        <x:Int32>1</x:Int32>
                                    </TapGestureRecognizer.CommandParameter>
                                </TapGestureRecognizer>
                            </Label.GestureRecognizers>
                            <Label.Triggers>
                                <DataTrigger TargetType="Label" Binding="{Binding SelectedRating}" Value="1">
                                    <Setter Property="Text" Value="â­"/>
                                </DataTrigger>
                                <DataTrigger TargetType="Label" Binding="{Binding SelectedRating}" Value="2">
                                    <Setter Property="Text" Value="â­"/>
                                </DataTrigger>
                                <DataTrigger TargetType="Label" Binding="{Binding SelectedRating}" Value="3">
                                    <Setter Property="Text" Value="â­"/>
                                </DataTrigger>
                                <DataTrigger TargetType="Label" Binding="{Binding SelectedRating}" Value="4">
                                    <Setter Property="Text" Value="â­"/>
                                </DataTrigger>
                                <DataTrigger TargetType="Label" Binding="{Binding SelectedRating}" Value="5">
                                    <Setter Property="Text" Value="â­"/>
                                </DataTrigger>
                            </Label.Triggers>
                        </Label>
                        
                        <!-- Star 2 -->
                        <Label FontSize="48" Text="â˜†">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding SetRatingCommand}">
                                    <TapGestureRecognizer.CommandParameter>
                                        <x:Int32>2</x:Int32>
                                    </TapGestureRecognizer.CommandParameter>
                                </TapGestureRecognizer>
                            </Label.GestureRecognizers>
                            <Label.Triggers>
                                <DataTrigger TargetType="Label" Binding="{Binding SelectedRating}" Value="2">
                                    <Setter Property="Text" Value="â­"/>
                                </DataTrigger>
                                <DataTrigger TargetType="Label" Binding="{Binding SelectedRating}" Value="3">
                                    <Setter Property="Text" Value="â­"/>
                                </DataTrigger>
                                <DataTrigger TargetType="Label" Binding="{Binding SelectedRating}" Value="4">
                                    <Setter Property="Text" Value="â­"/>
                                </DataTrigger>
                                <DataTrigger TargetType="Label" Binding="{Binding SelectedRating}" Value="5">
                                    <Setter Property="Text" Value="â­"/>
                                </DataTrigger>
                            </Label.Triggers>
                        </Label>
                        
                        <!-- Star 3 -->
                        <Label FontSize="48" Text="â˜†">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding SetRatingCommand}">
                                    <TapGestureRecognizer.CommandParameter>
                                        <x:Int32>3</x:Int32>
                                    </TapGestureRecognizer.CommandParameter>
                                </TapGestureRecognizer>
                            </Label.GestureRecognizers>
                            <Label.Triggers>
                                <DataTrigger TargetType="Label" Binding="{Binding SelectedRating}" Value="3">
                                    <Setter Property="Text" Value="â­"/>
                                </DataTrigger>
                                <DataTrigger TargetType="Label" Binding="{Binding SelectedRating}" Value="4">
                                    <Setter Property="Text" Value="â­"/>
                                </DataTrigger>
                                <DataTrigger TargetType="Label" Binding="{Binding SelectedRating}" Value="5">
                                    <Setter Property="Text" Value="â­"/>
                                </DataTrigger>
                            </Label.Triggers>
                        </Label>
                        
                        <!-- Star 4 -->
                        <Label FontSize="48" Text="â˜†">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding SetRatingCommand}">
                                    <TapGestureRecognizer.CommandParameter>
                                        <x:Int32>4</x:Int32>
                                    </TapGestureRecognizer.CommandParameter>
                                </TapGestureRecognizer>
                            </Label.GestureRecognizers>
                            <Label.Triggers>
                                <DataTrigger TargetType="Label" Binding="{Binding SelectedRating}" Value="4">
                                    <Setter Property="Text" Value="â­"/>
                                </DataTrigger>
                                <DataTrigger TargetType="Label" Binding="{Binding SelectedRating}" Value="5">
                                    <Setter Property="Text" Value="â­"/>
                                </DataTrigger>
                            </Label.Triggers>
                        </Label>
                        
                        <!-- Star 5 -->
                        <Label FontSize="48" Text="â˜†">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding SetRatingCommand}">
                                    <TapGestureRecognizer.CommandParameter>
                                        <x:Int32>5</x:Int32>
                                    </TapGestureRecognizer.CommandParameter>
                                </TapGestureRecognizer>
                            </Label.GestureRecognizers>
                            <Label.Triggers>
                                <DataTrigger TargetType="Label" Binding="{Binding SelectedRating}" Value="5">
                                    <Setter Property="Text" Value="â­"/>
                                </DataTrigger>
                            </Label.Triggers>
                        </Label>
                    </HorizontalStackLayout>
                    
                    <Label Text="{Binding SelectedRating, StringFormat='{0} out of 5 stars'}"
                           FontSize="14"
                           TextColor="#757575"
                           HorizontalTextAlignment="Center"/>
                </VerticalStackLayout>
            </Border>
            
            <!-- Review Text Card -->
            <Border StrokeThickness="0"
                    BackgroundColor="White"
                    Padding="18">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="15"/>
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="Black" Opacity="0.08" Radius="10" Offset="0,2"/>
                </Border.Shadow>
                
                <VerticalStackLayout Spacing="12">
                    <Label Text="ðŸ“ Your Review"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="#2196F3"/>
                    
                    <Border StrokeThickness="1"
                            Stroke="#E0E0E0"
                            BackgroundColor="#FAFAFA">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="10"/>
                        </Border.StrokeShape>
                        <Editor Text="{Binding CurrentReview.ReviewText}"
                                Placeholder="Share your experience..."
                                HeightRequest="160"
                                FontSize="15"
                                BackgroundColor="Transparent"/>
                    </Border>
                </VerticalStackLayout>
            </Border>
            
            <!-- Save Button -->
            <Border StrokeThickness="0"
                    BackgroundColor="#4CAF50"
                    Margin="0,10,0,20">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12"/>
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="#4CAF50" Opacity="0.3" Radius="10" Offset="0,4"/>
                </Border.Shadow>
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding SaveReviewCommand}"/>
                </Border.GestureRecognizers>
                <Label Text="ðŸ’¾ Save Review"
                       FontSize="17"
                       FontAttributes="Bold"
                       TextColor="White"
                       HorizontalOptions="Center"
                       Padding="0,16"/>
            </Border>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
